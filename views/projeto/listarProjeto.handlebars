<h2 class="mb-5 text-center text-primary fw-bold">Portfólio de Projetos</h2>

<form method="get" action="/listarProjeto" class="row g-3 mb-4 align-items-end">
    <div class="col-md-6">
        <label for="inputBusca" class="form-label fw-bold">Buscar Projeto</label>
        <input 
            id="inputBusca"
            type="text" 
            name="busca" 
            class="form-control" 
            placeholder="Digite o título do projeto, link ou nome do desenvolvedor..."
            value="{{filtroBusca}}">
    </div>

    <div class="col-md-4">
        <label for="selectPalavra" class="form-label fw-bold">Filtrar por Palavra-Chave</label>
        <select name="palavraChave" id="selectPalavra" class="form-select">
            <option value="">Todas as palavras-chave</option>
            {{#each palavras}}
                <option value="{{id}}" {{#if (eq ../filtroPalavra this.id)}}selected{{/if}}>{{palavra}}</option>
            {{/each}}
        </select>
    </div>

    <div class="col-md-2 d-flex gap-2">
        <button type="submit" class="btn btn-primary btn-sm w-50">Buscar</button>
        <a href="/listarProjeto" class="btn btn-secondary btn-sm w-50">Limpar</a>
    </div>
</form>

<div class="card shadow-sm">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th scope="col">Nome</th>
                        <th scope="col">Link</th>
                        <th scope="col">Palavras-Chave</th>
                        <th scope="col">Desenvolvedor(es)</th>
                        {{#if aluno}}
                            <th></th>
                            <th></th>
                        {{/if}}
                    </tr>
                </thead>
                <tbody>
                    {{#each projetos}}
                    <tr onclick="window.location='/visualizarProjeto/{{id}}'" style="cursor:pointer;"> 
                        <td>{{nome}}</td>
                        <td>
                            {{#if link}}
                                <a href="{{link}}" target="_blank">{{link}}</a>
                            {{else}}
                                <span class="text-muted">–</span>
                            {{/if}}
                        </td>
                        <td>{{palavrasChave}}</td>
                        <td>{{desenvolvedores}}</td>

                        {{#if ../aluno}}
                            {{#if ehDesenvolvedor}}
                                <td><a href="/editarProjeto/{{id}}" class="text-decoration-none text-primary">Editar</a></td>
                                <td><a href="/excluirProjeto/{{id}}" class="text-decoration-none text-danger">Excluir</a></td>
                            {{else}}
                                <td></td>
                                <td></td>
                            {{/if}}
                        {{/if}}
                    </tr>
                    {{/each}}
                    {{#unless projetos}}
                        <tr>
                            <td colspan="4" class="text-center p-4 ps-4">
                                Nenhum projeto encontrado.
                            </td>
                        </tr>
                    {{/unless}}

                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="mt-3 d-flex justify-content-between">
    {{#if (gt paginaAtual 1)}}
        <a href="/listarProjeto?pagina={{subtract paginaAtual 1}}&titulo={{filtroTitulo}}" class="btn btn-outline-secondary btn-sm">Anterior</a>
    {{else}}
        <span class="btn btn-outline-secondary btn-sm disabled">Anterior</span>
    {{/if}}

    <span>Página {{paginaAtual}} de {{totalPaginas}}</span>

    {{#if (lt paginaAtual totalPaginas)}}
        <a href="/listarProjeto?pagina={{add paginaAtual 1}}&titulo={{filtroTitulo}}" class="btn btn-outline-secondary btn-sm">Próxima</a>
    {{else}}
        <span class="btn btn-outline-secondary btn-sm disabled">Próxima</span>
    {{/if}}
</div>
